@model Tuple<GameSalesSystemMVC.Dtos.GameDto, List<GameSalesSystemMVC.Dtos.ReviewDto>>

@{
    ViewBag.Title = "Details";
}
@{ double avg_rating = 0.0;
    var avg_rating_str = ""; }
@try
{
    avg_rating = Model.Item2.Average(i => i.Rating);
    avg_rating = Math.Round(avg_rating, 2);
    avg_rating_str = avg_rating.ToString().Replace(',', '.');
}
catch (Exception)
{

}
<section>
    <div class="cs_height_35 cs_height_lg_35"></div>
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="cs_single_product_breadcrumb breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item"><a href="#">Shop</a></li>
                <li class="breadcrumb-item"><a href="#">Men</a></li>
                <li class="breadcrumb-item active">T-Shirt</li>
            </ol>
        </nav>
        <div class="row">
            <div class="col-xl-7">
                <div class="row">
                    <div class="col-9">
                        <div class="cs_single_product_thumb slick-slider">
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                            <div class="cs_single_product_thumb_item">
                                <img src="~/Pictures/@Model.Item1.Picture" alt="Thumb">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-5">
                <div class="cs_single_product_details">
                    <h2 class="cs_fs_37 cs_semibold">@Model.Item1.Title</h2>
                    <div class="cs_single_product_review">
                        <div class="cs_rating_container">
                            <div class="cs_rating cs_size_sm" data-rating="@avg_rating_str">
                                <div class="cs_rating_percentage"></div>
                            </div>
                        </div>
                        <span>(@avg_rating_str)</span>
                        <span>Stock: <span class="cs_accent_color">12 in stock</span></span>
                    </div>
                    <h4 class="cs_single_product_price cs_fs_21 cs_primary_color cs_semibold">Price: $@Model.Item1.Price</h4>
                    <hr>
                    <div class="cs_single_product_details_text">
                        <p class="mb-0">@Model.Item1.Description</p>
                    </div>
                    <div class="cs_single_product_size">
                        <h4 class="cs_fs_16 cs_medium">Genre</h4>
                        <ul class="cs_size_filter_list cs_mp0">
                            @Model.Item1.Genre
                        </ul>
                    </div>
                    <div class="cs_single_product_color ">
                        <h4 class="cs_fs_16 cs_medium">Release Date</h4>
                        <ul class="cs_color_filter_list cs_type_1 cs_mp0">
                            @Model.Item1.ReleaseDate.ToShortDateString()
                        </ul>
                    </div>
                    <div class="cs_action_btns">
                        <div class="cs_quantity">
                            <button class="cs_quantity_btn cs_increment"><i class="fa-solid fa-angle-up"></i></button>
                            <span class="cs_quantity_input">1</span>
                            <button class="cs_quantity_btn cs_decrement"><i class="fa-solid fa-angle-down"></i></button>
                        </div>
                        <a href="@Url.Action("AddToCart","Cart",new {id=Model.Item1.Id})" class="cs_btn cs_style_1 cs_fs_16 cs_medium">Add to Cart</a>
                        <button class="cs_heart_btn"><i class="fa-regular fa-heart"></i></button>
                    </div>

                </div>
            </div>
        </div>
        <div class="cs_height_70 cs_height_lg_60"></div>
        <hr>
        <div class="cs_product_meta_info">
            <ul class="cs_tab_links cs_style_2 cs_product_tab cs_fs_21 cs_primary_color cs_semibold cs_mp0">
                <li><a href="#tab_1">Description</a></li>
                <li><a href="#tab_2">Additional information</a></li>
                <li><a href="#tab_3">Size Guide</a></li>
                <li class="active"><a href="#tab_4">Review </a></li>
            </ul>
            <div class="cs_tabs">
                <div class="cs_tab" id="tab_1">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum sagittis orci ac odio dictum
                    tincidunt.
                    Donec ut metus leo. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos
                    himenaeos. Sed luctus, dui eu sagittis sodales, nulla nibh sagittis augue, vel porttitor diam enim non
                    metus.
                    Vestibulum aliquam augue neque. Phasellus tincidunt odio eget ullamcorper efficitur. Cras placerat ut
                    turpis
                    pellentesque vulputate. Nam sed consequat tortor. Curabitur finibus sapien dolor. Ut eleifend tellus nec
                    erat
                    pulvinar dignissim. Nam non arcu purus. Vivamus et massa massa.
                </div>
                <div class="cs_tab" id="tab_2">
                    <table class="m-0">
                        <tbody>
                            <tr>
                                <td>Color</td>
                                <td>Blue, Gray, Green, Red, Yellow</td>
                            </tr>
                            <tr>
                                <td>Size</td>
                                <td>Large, Medium, Small</td>
                            </tr>
                        </tbody>
                    </table>
                    <hr>
                </div>
                <div class="cs_tab" id="tab_3">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum sagittis orci ac odio dictum
                    tincidunt.
                    Donec ut metus leo. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos
                    himenaeos. Sed luctus, dui eu sagittis sodales, nulla nibh sagittis augue, vel porttitor diam enim non
                    metus.
                    Vestibulum aliquam augue neque. Phasellus tincidunt odio eget ullamcorper efficitur. Cras placerat ut
                    turpis
                    pellentesque vulputate. Nam sed consequat tortor. Curabitur finibus sapien dolor. Ut eleifend tellus nec
                    erat
                    pulvinar dignissim. Nam non arcu purus. Vivamus et massa massa.
                </div>
                <div class="cs_tab active" id="tab_4">
                    <ul class="cs_client_review_list cs_mp0">
                        @foreach (var item in Model.Item2)
                        {
                            <li>
                                <div class="cs_client_review">
                                    <div class="cs_review_media">
                                        <div class="cs_review_media_right">
                                            <div class="cs_rating_container">
                                                <div class="cs_rating cs_size_sm" data-rating="@item.Rating">
                                                    <div class="cs_rating_percentage"></div>
                                                </div>
                                            </div>
                                            <p class="mb-0 cs_primary_color cs_semibold">@item.User.NameSurname</p>
                                        </div>
                                        <p class="cs_review_posted_by">@item.ReviewDate.ToShortDateString()</p>
                                    </div>
                                    <p class="cs_review_text">
                                        @item.Comment
                                    </p>
                                </div>
                            </li>
                        }

                    </ul>

                    <div class="cs_height_20 cs_height_lg_20"></div>
                    <div class="cs_input_rating_wrap">
                        <p>Your rating  *</p>
                        <div class="cs_input_rating cs_accent_color" data-rating="0">
                            <i class="fa-regular fa-star" data-value="1"></i>
                            <i class="fa-regular fa-star" data-value="2"></i>
                            <i class="fa-regular fa-star" data-value="3"></i>
                            <i class="fa-regular fa-star" data-value="4"></i>
                            <i class="fa-regular fa-star" data-value="5"></i>
                        </div>
                    </div>
                    <div class="cs_height_20 cs_height_lg_22"></div>
                    <form class="row cs_review_form cs_gap_y_24">
                        <div class="col-lg-12">
                            <textarea rows="3" class="cs_form_field" placeholder="Write your review *" name="Comment" id="Comment"></textarea>
                        </div>

                        <div class="col-lg-12">
                            <div class="form_check">
                                <input class="form-check-input" type="checkbox">
                                <label class="form-check-label m-0">
                                    By using this form you agree with the storage and handling of your data by this website. *
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <button type="button" class="cs_btn cs_style_1 cs_fs_16 cs_medium" onclick="AddReview()">Submit Now</button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- .cs_tabs -->
        </div>
    </div>
</section>
@section scripts
{
    <script>

        // get star value
        var clickedValue;
        document.addEventListener("DOMContentLoaded", function () {
            // Get the rating element
            debugger;
            var ratingElement = document.querySelector('.cs_input_rating');

            // Add click event listener to stars
            var stars = ratingElement.querySelectorAll('.fa-regular.fa-star');
            stars.forEach(function (star) {
                star.addEventListener('click', function () {
                    // Get the value from the data-value attribute of the clicked star
                     clickedValue = star.getAttribute('data-value');

                    // Update the data-rating attribute of the rating element
                    ratingElement.setAttribute('data-rating', clickedValue);

                    // Log the selected value
                    console.log('Selected Rating:', clickedValue);
                });
            });
        });


        function AddReview() {
            debugger;
            var reviewDto =
            {
                GameId: @Model.Item1.Id,
                Comment: $('#Comment').val(),
                Rating: clickedValue
            };

            ajaxSendDataWithLoadingGetData(reviewDto, '/Review/InsertReview', null, function (response) {
                if (response.isSuccess) {
                    window.location.reload();
                }
                else {
                    alert(response.Message);
                }
            });


        }
    </script>
}
